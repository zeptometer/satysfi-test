module TestCaseResultStatus : sig

  type t

  val success : t
  val fail : t
  val cases : (| success : unit -> 'a; fail : unit -> 'a |) -> t -> 'a
  val eq : t -> t -> bool

end = struct

  type s = Success | Fail
  type t = s

  let success = Success

  let fail = Fail

  let cases branches status =
    match status with
    | Success -> branches#success ()
    | Fail -> branches#fail ()

  let eq a b =
    match a with
    | Success -> (
      match b with
      | Success -> true
      | Fail -> false)
    | Fail -> (
      match b with
      | Success -> false
      | Fail -> true)

end

module TestCaseResult : sig

  type t

  val of-test : (|
    description : string;
    status : TestCaseResultStatus.t
  |) -> t

  val cases : (|
    single : (| description : string; status : TestCaseResultStatus.t |) -> 'a
  |) -> t -> 'a

  val eq : t -> t -> bool

end = struct

  type s = (|
    description : string;
    status : TestCaseResultStatus.t
  |)
  type t = s

  let of-test result = result

  let cases branches result =
    result |> branches#single

  let eq a b =
    (string-same a#description b#description)
    && (TestCaseResultStatus.eq a#status b#status)

end
