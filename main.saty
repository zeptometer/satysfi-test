let assert b = if b then () else abort-with-message `Assertion failed` in

let test fn = (| run = fn |) in
let run test-case = test-case#run () in

let-mutable was-run <- false in

let () = assert (not (!was-run)) in

let test-case = test (fun () -> (was-run <- true)) in
let () = test-case |> run in

let () = assert (!was-run) in

`Following "The xUnit example" of "Test-Driven Development"`
